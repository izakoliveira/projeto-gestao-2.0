<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diagn√≥stico - Exclus√£o de Tarefas</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .diagnostico-item { margin: 10px 0; padding: 10px; border: 1px solid #ddd; border-radius: 5px; }
        .sucesso { background-color: #d4edda; border-color: #c3e6cb; }
        .erro { background-color: #f8d7da; border-color: #f5c6cb; }
        .aviso { background-color: #fff3cd; border-color: #ffeaa7; }
        .info { background-color: #d1ecf1; border-color: #bee5eb; }
        .console-output { background: #000; color: #0f0; padding: 10px; border-radius: 5px; font-family: monospace; max-height: 300px; overflow-y: auto; }
    </style>
</head>
<body>
    <div class="container mt-5">
        <h1>üîç Diagn√≥stico - Exclus√£o de Tarefas</h1>
        
        <div class="alert alert-info">
            <h5>üìã Este arquivo ajuda a identificar problemas na exclus√£o de tarefas</h5>
            <p>Clique em "Executar Diagn√≥stico" e verifique os resultados abaixo.</p>
        </div>

        <!-- Bot√µes de controle -->
        <div class="mb-4">
            <button class="btn btn-primary" onclick="executarDiagnostico()">
                <i class="fas fa-play"></i> Executar Diagn√≥stico
            </button>
            <button class="btn btn-secondary" onclick="limparResultados()">
                <i class="fas fa-broom"></i> Limpar Resultados
            </button>
            <button class="btn btn-info" onclick="testarExclusao()">
                <i class="fas fa-trash"></i> Testar Exclus√£o
            </button>
        </div>

        <!-- Resultados do diagn√≥stico -->
        <div id="resultados-diagnostico"></div>

        <!-- Console simulado -->
        <div class="mt-4">
            <h5>üì∫ Console Simulado</h5>
            <div id="console-output" class="console-output"></div>
        </div>

        <!-- Tabela de teste -->
        <div class="card mt-4">
            <div class="card-header">
                <h5>Tarefas de Teste</h5>
            </div>
            <div class="card-body">
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>Tarefa</th>
                            <th>Status</th>
                            <th>A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Tarefa de Teste 1</td>
                            <td><span class="badge bg-warning">Pendente</span></td>
                            <td>
                                <button class="btn btn-danger btn-sm btn-excluir-tarefa" 
                                        data-tarefa-id="teste-001">
                                    <i class="fas fa-trash"></i> Excluir
                                </button>
                            </td>
                        </tr>
                        <tr>
                            <td>Tarefa de Teste 2</td>
                            <td><span class="badge bg-success">Conclu√≠da</span></td>
                            <td>
                                <button class="btn btn-danger btn-sm btn-excluir-tarefa" 
                                        data-tarefa-id="teste-002">
                                    <i class="fas fa-trash"></i> Excluir
                                </button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // Console simulado
        const consoleOutput = document.getElementById('console-output');
        const originalConsole = {
            log: console.log,
            error: console.error,
            warn: console.warn,
            info: console.info
        };

        function logToConsole(message, type = 'log') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.innerHTML = `[${timestamp}] ${message}`;
            logEntry.style.color = type === 'error' ? '#ff6b6b' : 
                                 type === 'warn' ? '#feca57' : 
                                 type === 'info' ? '#48dbfb' : '#0f0';
            consoleOutput.appendChild(logEntry);
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
            
            // Tamb√©m logar no console real
            originalConsole[type](message);
        }

        // Sobrescrever console para capturar logs
        console.log = (msg) => logToConsole(msg, 'log');
        console.error = (msg) => logToConsole(msg, 'error');
        console.warn = (msg) => logToConsole(msg, 'warn');
        console.info = (msg) => logToConsole(msg, 'info');

        // Fun√ß√£o principal de diagn√≥stico
        function executarDiagnostico() {
            const resultados = document.getElementById('resultados-diagnostico');
            resultados.innerHTML = '';
            
            logToConsole('üîç Iniciando diagn√≥stico de exclus√£o de tarefas...');
            
            let resultadosHTML = '';
            
            // 1. Verificar Bootstrap
            const bootstrapStatus = typeof bootstrap !== 'undefined';
            const bootstrapModalStatus = typeof bootstrap?.Modal !== 'undefined';
            
            if (bootstrapStatus && bootstrapModalStatus) {
                resultadosHTML += '<div class="diagnostico-item sucesso"><i class="fas fa-check"></i> Bootstrap carregado corretamente</div>';
                logToConsole('‚úÖ Bootstrap carregado corretamente');
            } else {
                resultadosHTML += '<div class="diagnostico-item erro"><i class="fas fa-times"></i> Bootstrap n√£o carregado ou Modal n√£o dispon√≠vel</div>';
                logToConsole('‚ùå Bootstrap n√£o carregado ou Modal n√£o dispon√≠vel');
            }
            
            // 2. Verificar elementos HTML
            const botoes = document.querySelectorAll('.btn-excluir-tarefa');
            const modal = document.getElementById('modalConfirmarExclusaoTarefa');
            
            if (botoes.length > 0) {
                resultadosHTML += `<div class="diagnostico-item sucesso"><i class="fas fa-check"></i> ${botoes.length} bot√µes de exclus√£o encontrados</div>`;
                logToConsole(`‚úÖ ${botoes.length} bot√µes de exclus√£o encontrados`);
            } else {
                resultadosHTML += '<div class="diagnostico-item erro"><i class="fas fa-times"></i> Nenhum bot√£o de exclus√£o encontrado</div>';
                logToConsole('‚ùå Nenhum bot√£o de exclus√£o encontrado');
            }
            
            if (modal) {
                resultadosHTML += '<div class="diagnostico-item sucesso"><i class="fas fa-check"></i> Modal de confirma√ß√£o encontrado</div>';
                logToConsole('‚úÖ Modal de confirma√ß√£o encontrado');
            } else {
                resultadosHTML += '<div class="diagnostico-item erro"><i class="fas fa-times"></i> Modal de confirma√ß√£o n√£o encontrado</div>';
                logToConsole('‚ùå Modal de confirma√ß√£o n√£o encontrado');
            }
            
            // 3. Verificar JavaScript
            const funcoesDisponiveis = {
                'configurarExclusaoTarefas': typeof configurarExclusaoTarefas === 'function',
                'handleExclusaoClick': typeof handleExclusaoClick === 'function',
                'executarExclusao': typeof executarExclusao === 'function'
            };
            
            Object.entries(funcoesDisponiveis).forEach(([nome, disponivel]) => {
                if (disponivel) {
                    resultadosHTML += `<div class="diagnostico-item sucesso"><i class="fas fa-check"></i> Fun√ß√£o ${nome} dispon√≠vel</div>`;
                    logToConsole(`‚úÖ Fun√ß√£o ${nome} dispon√≠vel`);
                } else {
                    resultadosHTML += `<div class="diagnostico-item erro"><i class="fas fa-times"></i> Fun√ß√£o ${nome} n√£o dispon√≠vel</div>`;
                    logToConsole(`‚ùå Fun√ß√£o ${nome} n√£o dispon√≠vel`);
                }
            });
            
            // 4. Verificar event listeners
            try {
                const testEvent = new Event('click');
                logToConsole('‚úÖ Eventos funcionando corretamente');
            } catch (error) {
                resultadosHTML += '<div class="diagnostico-item erro"><i class="fas fa-times"></i> Problema com eventos</div>';
                logToConsole('‚ùå Problema com eventos: ' + error.message);
            }
            
            // 5. Verificar permiss√µes (simulado)
            const podeExcluir = true; // Simulado
            if (podeExcluir) {
                resultadosHTML += '<div class="diagnostico-item sucesso"><i class="fas fa-check"></i> Permiss√£o de exclus√£o concedida</div>';
                logToConsole('‚úÖ Permiss√£o de exclus√£o concedida');
            } else {
                resultadosHTML += '<div class="diagnostico-item erro"><i class="fas fa-times"></i> Sem permiss√£o para excluir</div>';
                logToConsole('‚ùå Sem permiss√£o para excluir');
            }
            
            resultados.innerHTML = resultadosHTML;
            logToConsole('üîç Diagn√≥stico conclu√≠do');
        }
        
        // Fun√ß√£o para testar exclus√£o
        function testarExclusao() {
            logToConsole('üß™ Testando funcionalidade de exclus√£o...');
            
            const botoes = document.querySelectorAll('.btn-excluir-tarefa');
            if (botoes.length === 0) {
                logToConsole('‚ùå Nenhum bot√£o de exclus√£o encontrado para teste');
                return;
            }
            
            const primeiroBotao = botoes[0];
            const tarefaId = primeiroBotao.getAttribute('data-tarefa-id');
            
            logToConsole(`üß™ Testando exclus√£o da tarefa: ${tarefaId}`);
            
            // Simular clique
            primeiroBotao.click();
        }
        
        // Fun√ß√£o para limpar resultados
        function limparResultados() {
            document.getElementById('resultados-diagnostico').innerHTML = '';
            document.getElementById('console-output').innerHTML = '';
            logToConsole('üßπ Resultados e console limpos');
        }
        
        // Configurar exclus√£o quando a p√°gina carregar
        document.addEventListener('DOMContentLoaded', function() {
            logToConsole('üöÄ DOMContentLoaded - Configurando exclus√£o');
            configurarExclusaoTarefas();
        });
        
        // Fun√ß√£o para configurar a exclus√£o
        function configurarExclusaoTarefas() {
            logToConsole('üîß Configurando exclus√£o de tarefas...');

            // Usar delega√ß√£o de eventos para capturar cliques
            document.removeEventListener('click', handleExclusaoClick);
            document.addEventListener('click', handleExclusaoClick);

            logToConsole('‚úÖ Event delegation configurado');
        }

        // Handler para cliques de exclus√£o
        function handleExclusaoClick(e) {
            // Verificar se clicou no bot√£o de exclus√£o
            if (e.target.closest('.btn-excluir-tarefa')) {
                e.preventDefault();
                e.stopPropagation();

                const btn = e.target.closest('.btn-excluir-tarefa');
                const tarefaId = btn.getAttribute('data-tarefa-id');

                logToConsole(`üóëÔ∏è Bot√£o de exclus√£o clicado para tarefa: ${tarefaId}`);

                if (!tarefaId) {
                    logToConsole('‚ùå ID da tarefa n√£o encontrado');
                    alert('Erro: ID da tarefa n√£o encontrado');
                    return;
                }

                // Simular exclus√£o
                if (confirm(`Tem certeza que deseja excluir a tarefa ${tarefaId}?`)) {
                    executarExclusao(tarefaId, btn);
                }
            }
        }

        // Fun√ß√£o para executar a exclus√£o
        function executarExclusao(tarefaId, btnExcluir) {
            logToConsole(`üóëÔ∏è Executando exclus√£o da tarefa: ${tarefaId}`);

            // Desabilitar bot√£o e mostrar spinner
            const originalContent = btnExcluir.innerHTML;
            btnExcluir.disabled = true;
            btnExcluir.innerHTML = '<span class="spinner-border spinner-border-sm"></span>';

            // Simular requisi√ß√£o
            setTimeout(() => {
                logToConsole('‚úÖ Tarefa exclu√≠da com sucesso (simulado)');

                // Remover linha da tabela com anima√ß√£o
                const tr = btnExcluir.closest('tr');
                if (tr) {
                    tr.style.transition = 'opacity 0.3s ease';
                    tr.style.opacity = '0';
                    setTimeout(() => {
                        tr.remove();
                        logToConsole('‚úÖ Linha removida da tabela');
                    }, 300);
                }

                // Mostrar mensagem de sucesso
                alert('Tarefa exclu√≠da com sucesso!');

            }, 1000);
        }
        
        // Configura√ß√£o imediata se o DOM j√° estiver pronto
        if (document.readyState === 'loading') {
            logToConsole('üìÑ DOM ainda carregando...');
        } else {
            logToConsole('üìÑ DOM j√° pronto, configurando imediatamente');
            configurarExclusaoTarefas();
        }
    </script>
</body>
</html>
