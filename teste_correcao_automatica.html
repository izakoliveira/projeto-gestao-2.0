<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste da Corre√ß√£o Autom√°tica</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .status-item {
            margin: 10px 0;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }

        .sucesso {
            background-color: #d4edda;
            border-color: #c3e6cb;
        }

        .erro {
            background-color: #f8d7da;
            border-color: #f5c6cb;
        }

        .aviso {
            background-color: #fff3cd;
            border-color: #ffeaa7;
        }
    </style>
</head>

<body>
    <div class="container mt-5">
        <h1>üß™ Teste da Corre√ß√£o Autom√°tica</h1>

        <div class="alert alert-success">
            <h5>‚úÖ Corre√ß√£o Implementada Automaticamente!</h5>
            <p>O script de corre√ß√£o foi inclu√≠do automaticamente nos templates principais.</p>
        </div>

        <!-- Status da Implementa√ß√£o -->
        <div class="card mb-4">
            <div class="card-header">
                <h5>üìã Status da Implementa√ß√£o</h5>
            </div>
            <div class="card-body">
                <div id="status-implementacao"></div>
            </div>
        </div>

        <!-- Tabela de Teste -->
        <div class="card">
            <div class="card-header">
                <h5>Tarefas de Teste</h5>
            </div>
            <div class="card-body">
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>Tarefa</th>
                            <th>Status</th>
                            <th>A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Tarefa de Teste 1</td>
                            <td><span class="badge bg-warning">Pendente</span></td>
                            <td>
                                <button class="btn btn-danger btn-sm btn-excluir-tarefa" data-tarefa-id="teste-001">
                                    <i class="fas fa-trash"></i> Excluir
                                </button>
                            </td>
                        </tr>
                        <tr>
                            <td>Tarefa de Teste 2</td>
                            <td><span class="badge bg-success">Conclu√≠da</span></td>
                            <td>
                                <button class="btn btn-danger btn-sm btn-excluir-tarefa" data-tarefa-id="teste-002">
                                    <i class="fas fa-trash"></i> Excluir
                                </button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Bot√µes de Controle -->
        <div class="mt-4">
            <button class="btn btn-primary" onclick="verificarImplementacao()">
                <i class="fas fa-check"></i> Verificar Implementa√ß√£o
            </button>
            <button class="btn btn-info" onclick="testarExclusao()">
                <i class="fas fa-trash"></i> Testar Exclus√£o
            </button>
            <button class="btn btn-warning" onclick="forcarReconfiguracao()">
                <i class="fas fa-sync"></i> For√ßar Reconfigura√ß√£o
            </button>
        </div>

        <!-- Resultados -->
        <div class="mt-4">
            <div id="resultados-teste"></div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>

    <!-- üîß SCRIPT DE CORRE√á√ÉO AUTOM√ÅTICA -->
    <script src="static/js/correcao_exclusao_tarefas.js"></script>

    <script>
        // Fun√ß√£o para verificar a implementa√ß√£o
        function verificarImplementacao() {
            const resultados = document.getElementById('resultados-teste');
            const status = document.getElementById('status-implementacao');

            resultados.innerHTML = '';

            let statusHTML = '';
            let resultadosHTML = '';

            // 1. Verificar se o script foi carregado
            if (typeof corrigirExclusaoTarefas === 'function') {
                statusHTML += '<div class="status-item sucesso"><i class="fas fa-check"></i> Script de corre√ß√£o carregado</div>';
                resultadosHTML += '<div class="alert alert-success">‚úÖ Script de corre√ß√£o carregado com sucesso!</div>';
            } else {
                statusHTML += '<div class="status-item erro"><i class="fas fa-times"></i> Script de corre√ß√£o n√£o carregado</div>';
                resultadosHTML += '<div class="alert alert-danger">‚ùå Script de corre√ß√£o n√£o foi carregado!</div>';
                return;
            }

            // 2. Verificar se as fun√ß√µes est√£o dispon√≠veis
            const funcoes = [
                'verificarStatusExclusao',
                'forcarReconfiguracao',
                'corrigirExclusaoTarefas'
            ];

            funcoes.forEach(funcao => {
                if (typeof window[funcao] === 'function') {
                    statusHTML += `<div class="status-item sucesso"><i class="fas fa-check"></i> Fun√ß√£o ${funcao} dispon√≠vel</div>`;
                } else {
                    statusHTML += `<div class="status-item erro"><i class="fas fa-times"></i> Fun√ß√£o ${funcao} n√£o dispon√≠vel</div>`;
                }
            });

            // 3. Verificar bot√µes de exclus√£o
            const botoes = document.querySelectorAll('.btn-excluir-tarefa');
            if (botoes.length > 0) {
                statusHTML += `<div class="status-item sucesso"><i class="fas fa-check"></i> ${botoes.length} bot√µes de exclus√£o encontrados</div>`;
            } else {
                statusHTML += '<div class="status-item erro"><i class="fas fa-times"></i> Nenhum bot√£o de exclus√£o encontrado</div>';
            }

            // 4. Verificar se o sistema est√° configurado
            if (window.exclusaoTarefasConfigurada) {
                statusHTML += '<div class="status-item sucesso"><i class="fas fa-check"></i> Sistema de exclus√£o configurado</div>';
                resultadosHTML += '<div class="alert alert-success">‚úÖ Sistema de exclus√£o configurado automaticamente!</div>';
            } else {
                statusHTML += '<div class="status-item aviso"><i class="fas fa-exclamation-triangle"></i> Sistema de exclus√£o n√£o configurado</div>';
                resultadosHTML += '<div class="alert alert-warning">‚ö†Ô∏è Sistema de exclus√£o n√£o configurado. Clique em "For√ßar Reconfigura√ß√£o".</div>';
            }

            status.innerHTML = statusHTML;
            resultados.innerHTML = resultadosHTML;
        }

        // Fun√ß√£o para testar exclus√£o
        function testarExclusao() {
            const resultados = document.getElementById('resultados-teste');

            if (!window.exclusaoTarefasConfigurada) {
                resultados.innerHTML = '<div class="alert alert-warning">‚ö†Ô∏è Configure o sistema primeiro usando "For√ßar Reconfigura√ß√£o"</div>';
                return;
            }

            const botoes = document.querySelectorAll('.btn-excluir-tarefa');
            if (botoes.length === 0) {
                resultados.innerHTML = '<div class="alert alert-warning">‚ö†Ô∏è Nenhum bot√£o de exclus√£o encontrado</div>';
                return;
            }

            const primeiroBotao = botoes[0];
            const tarefaId = primeiroBotao.getAttribute('data-tarefa-id');

            resultados.innerHTML = `<div class="alert alert-info">üß™ Testando exclus√£o da tarefa: ${tarefaId}</div>`;

            // Simular clique
            primeiroBotao.click();
        }

        // Fun√ß√£o para for√ßar reconfigura√ß√£o
        function forcarReconfiguracao() {
            const resultados = document.getElementById('resultados-teste');

            if (typeof forcarReconfiguracao === 'function') {
                try {
                    window.forcarReconfiguracao();
                    resultados.innerHTML = '<div class="alert alert-success">‚úÖ Reconfigura√ß√£o for√ßada executada!</div>';

                    // Verificar novamente ap√≥s reconfigura√ß√£o
                    setTimeout(() => {
                        verificarImplementacao();
                    }, 1000);
                } catch (error) {
                    resultados.innerHTML = `<div class="alert alert-danger">‚ùå Erro na reconfigura√ß√£o: ${error.message}</div>`;
                }
            } else {
                resultados.innerHTML = '<div class="alert alert-danger">‚ùå Fun√ß√£o de reconfigura√ß√£o n√£o dispon√≠vel</div>';
            }
        }

        // Verificar implementa√ß√£o quando a p√°gina carregar
        document.addEventListener('DOMContentLoaded', function () {
            console.log('üöÄ Verificando implementa√ß√£o autom√°tica...');
            setTimeout(() => {
                verificarImplementacao();
            }, 1000);
        });
    </script>
</body>

</html>